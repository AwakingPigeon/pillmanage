<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ‘éƒç—‡æ‚£è€…æœè¯æé†’</title>
    <style>
        :root {
            --primary-color: #FFB800;
            --background-color: #FFF8E1;
            --text-color: #5D4037;
            --border-color: #FFE082;
            --shadow-color: rgba(255, 183, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #FFF8E1 0%, #FFE082 100%);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 32px var(--shadow-color);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #FFB800 0%, #FFA726 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }

        .section {
            padding: 30px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .section h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 20px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--text-color);
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            background: #FFFEF7;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .time-inputs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .time-inputs input {
            flex: 1;
            min-width: 100px;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #FFB800 0%, #FFA726 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #9E9E9E 0%, #757575 100%);
            font-size: 14px;
            padding: 10px;
        }

        .medication-card {
            background: #FFFEF7;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .medication-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .medication-name {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .time-slot {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
        }

        .time-display {
            font-size: 16px;
            color: #FF8F00;
            font-weight: bold;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider {
            -webkit-appearance: none;
            width: 120px;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            transition: background 0.3s;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            transition: background 0.3s;
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: none;
        }

        .slider-value {
            font-size: 14px;
            color: var(--text-color);
            min-width: 60px;
            text-align: center;
        }

        .taken-indicator {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .taken-indicator.taken {
            background: #4CAF50;
            color: white;
        }

        .taken-indicator.pending {
            background: #FF9800;
            color: white;
        }

        .record-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            background: #FFFEF7;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .record-date {
            font-weight: bold;
            color: var(--text-color);
        }

        .record-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .record-status.taken {
            background: #4CAF50;
            color: white;
        }

        .record-status.missed {
            background: #f44336;
            color: white;
        }

        .hidden {
            display: none;
        }

        .nav {
            display: flex;
            background: white;
            border-top: 1px solid var(--border-color);
        }

        .nav-btn {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            transition: background 0.3s;
        }

        .nav-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .nav-btn:hover {
            background: #FFF8E1;
        }

        .add-time-btn {
            background: #E0E0E0;
            color: #666;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 10px;
        }

        .remove-time-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 10px;
            cursor: pointer;
            margin-left: 10px;
        }

        .medication-list {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’Š æœè¯æé†’</h1>
        </div>

        <!-- è®¾ç½®é¡µé¢ -->
        <div id="setup-section" class="section">
            <h2>è¯ç‰©è®¾ç½®</h2>
            <div id="medications-container">
                <!-- è¯ç‰©è®¾ç½®å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
            <button class="btn" onclick="addMedication()">+ æ·»åŠ è¯ç‰©</button>
            <button class="btn" onclick="saveSettings()">ä¿å­˜è®¾ç½®</button>
        </div>

        <!-- ä¸»é¡µé¢ -->
        <div id="main-section" class="section hidden">
            <h2>ä»Šæ—¥æœè¯</h2>
            <div id="today-medications">
                <!-- ä»Šæ—¥è¯ç‰©å°†åŠ¨æ€æ˜¾ç¤º -->
            </div>
            <button class="btn" onclick="showRecords()">æŸ¥çœ‹è®°å½•</button>
            <button class="btn btn-secondary" onclick="showSettings()">é‡æ–°è®¾ç½®</button>
        </div>

        <!-- è®°å½•é¡µé¢ -->
        <div id="records-section" class="section hidden">
            <h2>æœè¯è®°å½•</h2>
            <div id="records-list">
                <!-- è®°å½•å°†åŠ¨æ€æ˜¾ç¤º -->
            </div>
            <button class="btn" onclick="showMain()">è¿”å›</button>
        </div>

        <!-- å¯¼èˆª -->
        <div class="nav">
            <button class="nav-btn" onclick="showSettings()">è®¾ç½®</button>
            <button class="nav-btn active" onclick="showMain()">ä¸»é¡µ</button>
            <button class="nav-btn" onclick="showRecords()">è®°å½•</button>
        </div>
    </div>

    <script>
        let medications = [];
        let records = {};

        const PRESET_MEDICINES = {
            "æŠ—æŠ‘éƒè¯": ["ä¸™ç±³å—ª","é˜¿ç±³æ›¿æ—","æ°¯ç±³å¸•æ˜","é©¬æ™®æ›¿æ—","æ°Ÿè¥¿æ±€","èˆæ›²æ—","å¸•ç½—è¥¿æ±€","æ°Ÿä¼æ²™æ˜","è¥¿é…æ™®å…°","è‰¾å¸è¥¿é…æ™®å…°","æ–‡æ‹‰æ³•è¾›","åº¦æ´›è¥¿æ±€","ç±³æ°®å¹³","æ›²å”‘é…®","å®‰éä»–é…®"],
            "æŠ—ç²¾ç¥ç—…è¯": ["æ°¯ä¸™å—ª","å¥‹ä¹ƒé™","æ°Ÿå“Œå•¶é†‡","èˆ’å¿…åˆ©","æ°¯æ°®å¹³","åˆ©åŸ¹é…®","å¥¥æ°®å¹³","å–¹ç¡«å¹³","é˜¿ç«‹å“Œå”‘","é½æ‹‰è¥¿é…®","æ°¨ç£ºå¿…åˆ©"],
            "å¿ƒå¢ƒç¨³å®šå‰‚": ["ç¢³é…¸é”‚","ä¸™æˆŠé…¸ç›","å¡é©¬è¥¿å¹³","æ‹‰è«ä¸‰å—ª","å¥¥æ°®å¹³","å–¹ç¡«å¹³","åˆ©åŸ¹é…®","é˜¿ç«‹å“Œå”‘"],
            "æŠ—ç„¦è™‘è¯": ["åœ°è¥¿æ³®","é˜¿æ™®å”‘ä»‘","æ°¯ç¡è¥¿æ³®","åŠ³æ‹‰è¥¿æ³®","è‰¾å¸å”‘ä»‘","ä¸èºç¯é…®","å¦åº¦èºé…®"],
            "é•‡é™å‚¬çœ è¯": ["åœ°è¥¿æ³®","é˜¿æ™®å”‘ä»‘","è‰¾å¸å”‘ä»‘","åŠ³æ‹‰è¥¿æ³®","ä¸‰å”‘ä»‘","å’ªè¾¾å”‘ä»‘","å”‘å¡å¦","ä½åŒ¹å…‹éš†","å³ä½åŒ¹å…‹éš†"],
            "ç²¾ç¥æŒ¯å¥‹/ADHD": ["å“Œç”²é…¯","è«è¾¾éå°¼"],
            "æ”¹å–„è®¤çŸ¥éšœç¢": ["å¤šå¥ˆå“Œé½","åŠ å…°ä»–æ•","å¡å·´æ‹‰æ±€","ç¾é‡‘åˆš","å°¼éº¦è§’æ—","èƒç£·èƒ†ç¢±"]
        }

        // åˆå§‹åŒ–åº”ç”¨
        function initApp() {
            loadData();
            if (medications.length > 0) {
                showMain();
            } else {
                showSettings();
            }
        }

        // åŠ è½½æ•°æ®
        function loadData() {
            const savedMeds = localStorage.getItem('medications');
            const savedRecords = localStorage.getItem('medication_records');
            
            if (savedMeds) {
                medications = JSON.parse(savedMeds);
            }
            
            if (savedRecords) {
                records = JSON.parse(savedRecords);
            }
        }

        // ä¿å­˜æ•°æ®
        function saveData() {
            localStorage.setItem('medications', JSON.stringify(medications));
            localStorage.setItem('medication_records', JSON.stringify(records));
        }

        // æ˜¾ç¤ºè®¾ç½®é¡µé¢
        function showSettings() {
            document.getElementById('setup-section').classList.remove('hidden');
            document.getElementById('main-section').classList.add('hidden');
            document.getElementById('records-section').classList.add('hidden');
            renderMedicationsSetup();
        }

        // æ˜¾ç¤ºä¸»é¡µé¢
        function showMain() {
            document.getElementById('setup-section').classList.add('hidden');
            document.getElementById('main-section').classList.remove('hidden');
            document.getElementById('records-section').classList.add('hidden');
            renderTodayMedications();
        }

        // æ˜¾ç¤ºè®°å½•é¡µé¢
        function showRecords() {
            document.getElementById('setup-section').classList.add('hidden');
            document.getElementById('main-section').classList.add('hidden');
            document.getElementById('records-section').classList.remove('hidden');
            renderRecords();
        }

        // æ·»åŠ è¯ç‰©
        function addMedication() {
            const medId = Date.now();
            medications.push({
                id: medId,
                category: '',
                name: '',
                useCustom: false,
                customName: '',
                times: ['09:00']
            });
            renderMedicationsSetup();
        }

        // åˆ é™¤è¯ç‰©
        function removeMedication(medId) {
            medications = medications.filter(med => med.id !== medId);
            renderMedicationsSetup();
        }

        // æ·»åŠ æ—¶é—´
        function addTime(medId) {
            const medication = medications.find(med => med.id === medId);
            if (medication && medication.times.length < 5) {
                medication.times.push('12:00');
                renderMedicationsSetup();
            }
        }

        // åˆ é™¤æ—¶é—´
        function removeTime(medId, timeIndex) {
            const medication = medications.find(med => med.id === medId);
            if (medication && medication.times.length > 1) {
                medication.times.splice(timeIndex, 1);
                renderMedicationsSetup();
            }
        }

        // æ¸²æŸ“è¯ç‰©è®¾ç½®
        function renderMedicationsSetup() {
            const container = document.getElementById('medications-container');
            container.innerHTML = '';

            medications.forEach((med, index) => {
                const medDiv = document.createElement('div');
                medDiv.className = 'medication-card';
                const categories = Object.keys(PRESET_MEDICINES)
                const drugOptions = med.category && PRESET_MEDICINES[med.category] ? PRESET_MEDICINES[med.category] : []
                medDiv.innerHTML = `
                    <div class="medication-header">
                        <span>è¯ç‰© ${index + 1}</span>
                        <button class="remove-time-btn" onclick="removeMedication(${med.id})">åˆ é™¤</button>
                    </div>
                    <div class="input-group">
                        <label>è¯ç‰©åˆ†ç±»ï¼š</label>
                        <select onchange="updateMedicationCategory(${med.id}, this.value)">
                            <option value="">è¯·é€‰æ‹©åˆ†ç±»</option>
                            ${categories.map(c => `<option value="${c}" ${med.category===c?'selected':''}>${c}</option>`).join('')}
                        </select>
                    </div>
                    <div class="input-group">
                        <label>è¯ç‰©åç§°ï¼š</label>
                        <select onchange="updateMedicationNameSelect(${med.id}, this.value)">
                            <option value="">è¯·é€‰æ‹©è¯ç‰©</option>
                            ${drugOptions.map(n => `<option value="${n}" ${(!med.useCustom && med.name===n)?'selected':''}>${n}</option>`).join('')}
                            <option value="__other__" ${med.useCustom?'selected':''}>å…¶ä»–</option>
                        </select>
                        ${med.useCustom ? `
                          <input type="text" value="${med.customName||''}" 
                                 onchange="updateMedicationCustomName(${med.id}, this.value)" 
                                 placeholder="è¯·è¾“å…¥è¯ç‰©åç§°" maxlength="20">
                        ` : ''}
                    </div>
                    <div class="input-group">
                        <label>æé†’æ—¶é—´ï¼š</label>
                        <div id="times-${med.id}">
                            ${med.times.map((time, timeIndex) => `
                                <div class="time-inputs">
                                    <input type="time" value="${time}" 
                                           onchange="updateMedicationTime(${med.id}, ${timeIndex}, this.value)">
                                    ${med.times.length > 1 ? 
                                        `<button class="remove-time-btn" onclick="removeTime(${med.id}, ${timeIndex})">-</button>` : 
                                        ''}
                                </div>
                            `).join('')}
                        </div>
                        ${med.times.length < 5 ? 
                            `<button class="add-time-btn" onclick="addTime(${med.id})">+ æ·»åŠ æ—¶é—´</button>` : 
                            ''}
                    </div>
                `;
                container.appendChild(medDiv);
            });

            if (medications.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">æš‚æ— è¯ç‰©è®¾ç½®</p>';
            }
        }

        // æ›´æ–°è¯ç‰©åç§°
        function updateMedicationCategory(medId, category) {
            const medication = medications.find(med => med.id === medId);
            if (medication) {
                medication.category = category;
                medication.useCustom = false;
                medication.customName = '';
                medication.name = '';
                renderMedicationsSetup();
            }
        }

        function updateMedicationNameSelect(medId, value) {
            const medication = medications.find(med => med.id === medId);
            if (medication) {
                if (value === '__other__') {
                    medication.useCustom = true;
                    medication.name = '';
                } else {
                    medication.useCustom = false;
                    medication.name = value;
                }
                renderMedicationsSetup();
            }
        }

        function updateMedicationCustomName(medId, name) {
            const medication = medications.find(med => med.id === medId);
            if (medication) {
                medication.customName = name;
            }
        }

        // æ›´æ–°è¯ç‰©æ—¶é—´
        function updateMedicationTime(medId, timeIndex, time) {
            const medication = medications.find(med => med.id === medId);
            if (medication) {
                medication.times[timeIndex] = time;
            }
        }

        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            // éªŒè¯è¾“å…¥
            for (let med of medications) {
                const finalName = med.useCustom ? (med.customName||'').trim() : (med.name||'').trim()
                if (!finalName) {
                    alert('è¯·å¡«å†™æ‰€æœ‰è¯ç‰©åç§°');
                    return;
                }
                if (med.times.some(time => !time)) {
                    alert('è¯·å¡«å†™æ‰€æœ‰æé†’æ—¶é—´');
                    return;
                }
            }

            saveData();
            showMain();
        }

        // æ¸²æŸ“ä»Šæ—¥è¯ç‰©
        function renderTodayMedications() {
            const container = document.getElementById('today-medications');
            container.innerHTML = '';

            const today = new Date().toISOString().split('T')[0];
            const now = new Date();
            const currentTime = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');

            if (medications.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">æš‚æ— è¯ç‰©è®¾ç½®</p>';
                return;
            }

            medications.forEach(med => {
                const medDiv = document.createElement('div');
                medDiv.className = 'medication-card';
                
                let timeSlotsHtml = '';
                med.times.forEach((time, timeIndex) => {
                    const recordKey = `${today}_${med.id}_${timeIndex}`;
                    const isTaken = records[recordKey];
                    
                    timeSlotsHtml += `
                        <div class="time-slot">
                            <div>
                                <div class="medication-name">${med.useCustom ? (med.customName||'') : med.name}</div>
                                <div class="time-display">${time}</div>
                            </div>
                            <div class="slider-container">
                                ${!isTaken ? 
                                    `<input type="range" class="slider" min="0" max="100" value="0" 
                                            id="slider-${med.id}-${timeIndex}" 
                                            oninput="updateSliderValue(${med.id}, ${timeIndex}, this.value)"
                                            onchange="handleSliderConfirm(${med.id}, ${timeIndex}, this.value)">
                                    <span class="slider-value" id="value-${med.id}-${timeIndex}">0%</span>` : 
                                    '<span class="taken-indicator taken">å·²æœç”¨</span>'
                                }
                            </div>
                        </div>
                    `;
                });

                medDiv.innerHTML = `
                    <div class="medication-header">
                        <span class="medication-name">${med.useCustom ? (med.customName||'') : med.name}</span>
                    </div>
                    ${timeSlotsHtml}
                `;
                container.appendChild(medDiv);
            });
        }

        // æ›´æ–°æ»‘å—å€¼
        function updateSliderValue(medId, timeIndex, value) {
            const valueDisplay = document.getElementById(`value-${medId}-${timeIndex}`);
            if (valueDisplay) {
                valueDisplay.textContent = value + '%';
            }
        }

        // å¤„ç†æ»‘åŠ¨ç¡®è®¤
        function handleSliderConfirm(medId, timeIndex, value) {
            if (parseInt(value) >= 80) {
                const today = new Date().toISOString().split('T')[0];
                const recordKey = `${today}_${medId}_${timeIndex}`;
                
                // æ‰¾åˆ°å¯¹åº”çš„è¯ç‰©
                const medication = medications.find(med => med.id === medId);
                if (medication) {
                    const finalName = medication.useCustom ? (medication.customName||'') : medication.name
                    records[recordKey] = {
                        medicationName: finalName,
                        time: medication.times[timeIndex],
                        takenAt: new Date().toISOString()
                    };
                    
                    saveData();
                    renderTodayMedications();
                    
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    showNotification(`${medication.name} - ${medication.times[timeIndex]} å·²ç¡®è®¤æœç”¨ï¼`);
                }
            } else {
                // é‡ç½®æ»‘å—
                const slider = document.getElementById(`slider-${medId}-${timeIndex}`);
                if (slider) {
                    slider.value = 0;
                    updateSliderValue(medId, timeIndex, 0);
                }
            }
        }

        // æ¸²æŸ“è®°å½•
        function renderRecords() {
            const container = document.getElementById('records-list');
            container.innerHTML = '';

            const recordEntries = Object.entries(records);
            if (recordEntries.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">æš‚æ— æœè¯è®°å½•</p>';
                return;
            }

            // æŒ‰æ—¥æœŸæ’åº
            const sortedRecords = recordEntries.sort((a, b) => new Date(b[1].takenAt) - new Date(a[1].takenAt));

            sortedRecords.forEach(([key, record]) => {
                const [date, medId, timeIndex] = key.split('_');
                const recordDiv = document.createElement('div');
                recordDiv.className = 'record-item';
                
                const takenDate = new Date(record.takenAt);
                const takenTime = takenDate.toLocaleTimeString('zh-CN', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                recordDiv.innerHTML = `
                    <div>
                        <div class="record-date">${formatDate(date)} ${record.medicationName}</div>
                        <div style="font-size: 12px; color: #666;">
                            è®¡åˆ’æ—¶é—´: ${record.time} | å®é™…æ—¶é—´: ${takenTime}
                        </div>
                    </div>
                    <span class="record-status taken">å·²æœç”¨</span>
                `;
                container.appendChild(recordDiv);
            });
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const targetDate = new Date(dateStr);
            targetDate.setHours(0, 0, 0, 0);
            
            if (targetDate.getTime() === today.getTime()) {
                return 'ä»Šå¤©';
            }
            
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            if (targetDate.getTime() === yesterday.getTime()) {
                return 'æ˜¨å¤©';
            }
            
            return `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('æœè¯æé†’', {
                    body: message,
                    icon: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23FFB800"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>'
                });
            } else {
                // ä½¿ç”¨alertä½œä¸ºå¤‡é€‰
                alert(message);
            }
        }

        // è¯·æ±‚é€šçŸ¥æƒé™
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            requestNotificationPermission();
        });

        // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦éœ€è¦æé†’
        setInterval(() => {
            checkReminders();
        }, 60000);

        // æ£€æŸ¥æé†’
        function checkReminders() {
            const now = new Date();
            const currentTime = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
            const today = now.toISOString().split('T')[0];

            medications.forEach(med => {
                med.times.forEach((time, timeIndex) => {
                    const recordKey = `${today}_${med.id}_${timeIndex}`;
                    
                    // å¦‚æœæ—¶é—´æ˜¯å½“å‰æ—¶é—´æˆ–å·²è¿‡ä½†æœªè®°å½•
                    if (time === currentTime && !records[recordKey]) {
                        showNotification(`${med.name} æœè¯æ—¶é—´åˆ°äº†ï¼è¯·æ»‘åŠ¨ç¡®è®¤æœç”¨ã€‚`);
                    }
                });
            });
        }
    </script>
</body>
</html>
